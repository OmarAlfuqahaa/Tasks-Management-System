<form (ngSubmit)="saveTask()" [formGroup]="taskForm">
  @if (apiError) {
    <div class="feedback error">
      {{ apiError }}
    </div>
  }
  @if (successMessage) {
    <div class="feedback success">
      {{ successMessage }}
    </div>
  }
  @if (!canEditLoadedTask && !loading) {
    <div class="permission-banner">
      You can view this task but do not have permission to update it.
    </div>
  }
  <h2>Edit Task</h2>


  <mat-form-field appearance="outline">
    <mat-label>Title</mat-label>
    <input formControlName="title" matInput>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Description</mat-label>
    <textarea formControlName="description" matInput></textarea>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Assigned To</mat-label>
    <mat-select [disabled]="!canUpdateAssignee() || taskForm.disabled" formControlName="assignedUserId">
      @for (user of assignees; track user.id) {
        <mat-option [value]="user.id">
          {{ user.name }} â€” {{ user.role }}
        </mat-option>
      }
    </mat-select>
  </mat-form-field>
  @if (assigneesLoading) {
    <div class="inline-state">Loading available users...</div>
  }
  @if (assigneesError) {
    <div class="inline-state error">{{ assigneesError }}</div>
  }

  <mat-form-field appearance="outline">
    <mat-label>Status</mat-label>
    <mat-select formControlName="status">
      @for (s of statuses; track s.value) {
        <mat-option [value]="s.value">{{ s.label }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <button [disabled]="loading || !canEditLoadedTask" color="primary" mat-raised-button type="submit">
    {{ loading ? 'Saving...' : 'Save' }}
  </button>
</form>

